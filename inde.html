<!DOCTYPE html>
<html lang="uz">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Shashka O‚Äòyini</title>
<style>
body{margin:0;background:#222;color:#fff;font-family:Arial;display:flex;justify-content:center;align-items:center;flex-direction:column;min-height:100vh;}
#menu,#game{width:90%;max-width:400px;background:#333;padding:15px;border-radius:12px;text-align:center;}
.hidden{display:none}
input,select,button{width:100%;padding:10px;margin:6px 0;font-size:18px;border-radius:6px;}
button{background:#4caf50;color:#fff;border:none;cursor:pointer;}
#info{margin-bottom:8px;font-size:18px}
.board{display:grid;grid-template-columns:repeat(8,1fr);aspect-ratio:1;border:4px solid #111;}
.cell{display:flex;align-items:center;justify-content:center;font-size:calc(22px + 2vmin);user-select:none;}
.white{background:#f0d9b5}
.black{background:#b58863}
.selected{outline:3px solid red}
.move{background:#7fc97f!important}
.logo{width:120px;max-width:60%;margin:0 auto 10px;display:block;}
.logoText{font-size:28px;color:#4caf50;margin-bottom:10px;font-weight:bold;}
</style>
</head>
<body>

<div id="menu">
  <img src="logo.png" class="logo">
  <!-- <div class="logoText">‚ôüÔ∏è SHASHKA PRO</div> -->
  <input id="p1" placeholder="1-o‚Äòyinchi">
  <input id="p2" placeholder="2-o‚Äòyinchi / AI">
  <select id="mode">
    <option value="pvp">Odam vs Odam</option>
    <option value="ai">Odam vs AI</option>
  </select>
  <button onclick="start()">Boshlash</button>
  <p style="margin-top:10px;font-size:14px;color:#ccc">
    Savollar uchun: <b>946612013</b>
  </p>
</div>

<div id="game" class="hidden">
  <div id="info"></div>
  <button onclick="undo()">‚è™ Orqaga olish</button>
  <div class="board" id="board"></div>
</div>

<script>
const menu=document.getElementById("menu");
const game=document.getElementById("game");
const boardEl=document.getElementById("board");
const info=document.getElementById("info");

let turn="w", selected=null, moves=[], history=[];
let mode="pvp";
let p1="Oq", p2="Qora";

let board=[
 ["","b","","b","","b","","b"],
 ["b","","b","","b","","b",""],
 ["","b","","b","","b","","b"],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["w","","w","","w","","w",""],
 ["","w","","w","","w","","w"],
 ["w","","w","","w","","w",""]
];

function start(){
  const in1=document.getElementById("p1").value;
  const in2=document.getElementById("p2").value;
  p1=in1||"Oq"; p2=in2||"Qora";
  mode=document.getElementById("mode").value;
  menu.classList.add("hidden"); game.classList.remove("hidden");
  draw();
  if(mode==="ai" && turn==="b") setTimeout(aiMove,400);
}

function draw(){
  boardEl.innerHTML="";
  info.textContent=(turn==="w"?p1:p2)+" yurmoqda";
  for(let r=0;r<8;r++)
    for(let c=0;c<8;c++){
      let d=document.createElement("div");
      d.className="cell "+((r+c)%2?"black":"white");
      let v=board[r][c];
      d.textContent=v==="w"?"‚ö™":v==="b"?"‚ö´":v==="W"?"üëë":v==="B"?"üëë":"";
      d.onclick=()=>clickCell(r,c);
      boardEl.appendChild(d);
    }
}

function save(){ history.push(JSON.parse(JSON.stringify(board))); }

function undo(){
  if(!history.length) return;
  board=history.pop(); turn=turn==="w"?"b":"w"; draw();
}

function clickCell(r,c){
  clear();
  if(selected){
    for(let m of moves){
      if(m[0]==r && m[1]==c){
        save();
        board[r][c]=board[selected[0]][selected[1]];
        board[selected[0]][selected[1]]="";
        if(m.length===4) board[m[2]][m[3]]="";
        king(r,c); selected=null;
        turn=turn==="w"?"b":"w";
        draw();
        if(mode==="ai" && turn==="b") setTimeout(aiMove,400);
        checkWinner();
        return;
      }
    }
  }
  let v=board[r][c];
  if(!v) return;
  if(turn==="w"&&(v==="w"||v==="W")||turn==="b"&&(v==="b"||v==="B")){
    selected=[r,c]; moves=calcMoves(r,c,v); mark();
  }
}

function calcMoves(r,c,p){
  const res=[], cap=[];
  const enemy=p.toLowerCase()==="w"?["b","B"]:["w","W"];
  const dirs=[];
  if(p==="w") dirs.push([-1,-1],[-1,1]);
  if(p==="b") dirs.push([1,-1],[1,1]);
  if(p==="W"||p==="B") dirs.push([-1,-1],[-1,1],[1,-1],[1,1]);

  dirs.forEach(d=>{
    let r1=r+d[0],c1=c+d[1],r2=r+d[0]*2,c2=c+d[1]*2;
    if(enemy.includes(board[r1]?.[c1])&&board[r2]?.[c2]==="") cap.push([r2,c2,r1,c1]);
  });
  if(cap.length) return cap;
  dirs.forEach(d=>{
    if(board[r+d[0]]?.[c+d[1]]==="") res.push([r+d[0],c+d[1]]);
  });
  return res;
}

function king(r,c){
  if(board[r][c]==="w"&&r===0) board[r][c]="W";
  if(board[r][c]==="b"&&r===7) board[r][c]="B";
}

function mark(){
  document.querySelectorAll(".cell").forEach((c,i)=>{
    let r=Math.floor(i/8), co=i%8;
    if(selected && r==selected[0] && co==selected[1]) c.classList.add("selected");
    moves.forEach(m=>{if(m[0]==r && m[1]==co) c.classList.add("move")});
  });
}

function clear(){
  document.querySelectorAll(".cell").forEach(c=>c.classList.remove("selected","move"));
}

// AQILLI AI
function aiMove(){
  let all=[];
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      let v=board[r][c];
      if(v==="b"||v==="B"){
        let m=calcMoves(r,c,v);
        m.forEach(x=>all.push([r,c,...x]));
      }
    }
  }
  if(!all.length) return;
  let capture=all.filter(m=>m.length===6); 
  let move = capture.length? capture[Math.floor(Math.random()*capture.length)] 
                          : all[Math.floor(Math.random()*all.length)];
  save();
  board[move[2]][move[3]]=board[move[0]][move[1]];
  board[move[0]][move[1]]="";
  if(move.length===6) board[move[4]][move[5]]="";
  king(move[2],move[3]);
  turn="w";
  draw();
  checkWinner();
}

// G‚Äòalaba va durang tekshiruvi
function checkWinner(){
  let w=false,b=false, empty=false;
  for(let r=0;r<8;r++) for(let c=0;c<8;c++){
    if(board[r][c]=="w"||board[r][c]=="W") w=true;
    if(board[r][c]=="b"||board[r][c]=="B") b=true;
    if(board[r][c]=="") empty=true;
  }
  if(!w){ alert("Qora g‚Äòalaba! \nXabar Telegram: 946612013"); reset(); return;}
  if(!b){ alert("Oq g‚Äòalaba! \nXabar Telegram: 946612013"); reset(); return;}
  // Durang sharti: hech qanday yurish qolmasa yoki faqat bir rang qolsa
  let movesLeft=false;
  for(let r=0;r<8;r++){
    for(let c=0;c<8;c++){
      if(board[r][c]!=="") {
        if(calcMoves(r,c,board[r][c]).length>0) movesLeft=true;
      }
    }
  }
  if(!movesLeft){
    alert("Durang! \nXabar Telegram: 946612013");
    reset();
  }
}

function reset(){
  board=[
 ["","b","","b","","b","","b"],
 ["b","","b","","b","","b",""],
 ["","b","","b","","b","","b"],
 ["","","","","","","",""],
 ["","","","","","","",""],
 ["w","","w","","w","","w",""],
 ["","w","","w","","w","","w"],
 ["w","","w","","w","","w",""]
  ];
  turn="w"; history=[]; draw();
}
</script>

</body>
</html>
